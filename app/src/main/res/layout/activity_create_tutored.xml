<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:bind="http://schemas.android.com/apk/res-auto"
    tools:context=".view.tutored.CreateTutoredActivity">

    <data>
        <variable
            name="viewModel"
            type="mz.org.csaude.mentoring.viewmodel.tutored.TutoredVM" />

        <variable
            name="viewModelProvince"
            type="mz.org.csaude.mentoring.viewmodel.location.ProvinceVM" />

        <!-- Adapters -->
        <variable
            name="professionalCategoryAdapter"
            type="mz.org.csaude.mentoring.adapter.spinner.listble.ListableSpinnerAdapter" />
        <variable
            name="provinceAdapter"
            type="mz.org.csaude.mentoring.adapter.spinner.listble.ListableSpinnerAdapter" />
        <variable
            name="districtAdapter"
            type="mz.org.csaude.mentoring.adapter.spinner.listble.ListableSpinnerAdapter" />
        <variable
            name="healthfacilityAdapter"
            type="mz.org.csaude.mentoring.adapter.spinner.listble.ListableSpinnerAdapter" />
        <variable
            name="menteeLaborfoAdapter"
            type="mz.org.csaude.mentoring.adapter.spinner.listble.ListableSpinnerAdapter" />
        <variable
            name="ngoAdapter"
            type="mz.org.csaude.mentoring.adapter.spinner.listble.ListableSpinnerAdapter" />

        <import type="android.view.View" />
    </data>

    <androidx.coordinatorlayout.widget.CoordinatorLayout
        android:layout_width="match_parent"
        android:background="@color/white"
        android:layout_height="match_parent">

        <!-- AppBar / Toolbar -->
        <com.google.android.material.appbar.AppBarLayout
            android:id="@+id/appBarLayout2"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            app:elevation="4dp">

            <include
                android:id="@+id/toolbar"
                layout="@layout/app_toolbar"
                android:layout_width="match_parent"
                android:layout_height="wrap_content" />
        </com.google.android.material.appbar.AppBarLayout>

        <!-- Container que alterna FORM <-> CARD de estado -->
        <FrameLayout
            android:id="@+id/content_container"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:backgroundTint="@color/white"
            app:layout_behavior="@string/appbar_scrolling_view_behavior">

            <!-- FORM: visível quando NÃO está a salvar -->
            <androidx.core.widget.NestedScrollView
                android:id="@+id/form_scroll"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:padding="@dimen/dimen_10dp"
                android:backgroundTint="@color/white"
                android:visibility='@{viewModel.savingCardVisible ? View.GONE : View.VISIBLE}'>

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:backgroundTint="@color/white"
                    android:orientation="vertical">

                    <!-- ============ CARD: Identificação ============ -->
                    <com.google.android.material.card.MaterialCardView
                        android:id="@+id/card_identificacao"
                        style="@style/Mentor.M3.Card"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginBottom="@dimen/dimen_12dp">

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="vertical"
                            android:padding="@dimen/dimen_16dp">

                            <!-- Cabeçalho (accordion) -->
                            <LinearLayout
                                android:id="@+id/identification_data"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="horizontal"
                                android:gravity="center_vertical"
                                android:onClick='@{(v)->viewModel.changeInitialDataViewStatus(v)}'>

                                <com.google.android.material.textview.MaterialTextView
                                    android:layout_width="0dp"
                                    android:layout_height="wrap_content"
                                    android:layout_weight="1"
                                    android:textColor="@color/background_dark"
                                    android:text="@string/identification_data_label"
                                    android:textAppearance="?attr/textAppearanceTitleLarge" />

                                <ImageButton
                                    android:id="@+id/btn_identification_data"
                                    android:layout_width="40dp"
                                    android:layout_height="40dp"
                                    android:background="?attr/selectableItemBackgroundBorderless"
                                    android:contentDescription="@string/expand"
                                    android:src="@drawable/baseline_expand_more_24" />
                            </LinearLayout>

                            <!-- Corpo -->
                            <LinearLayout
                                android:id="@+id/identification_data_lyt"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="vertical"
                                android:paddingTop="@dimen/dimen_8dp">

                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:hint="@string/tutored_name_label">
                                    <com.google.android.material.textfield.TextInputEditText
                                        android:id="@+id/tutored_name"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:text='@={viewModel.name}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/tutored_surname_label">
                                    <com.google.android.material.textfield.TextInputEditText
                                        android:id="@+id/tutored_surname"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:text='@={viewModel.surname}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/tutored_phone_number_label"
                                    app:startIconDrawable="@drawable/baseline_call_24">
                                    <com.google.android.material.textfield.TextInputEditText
                                        android:id="@+id/tutored_phone_number"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="phone"
                                        android:maxLength="9"
                                        android:text='@={viewModel.phoneNumber}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/tutored_email_label"
                                    app:startIconDrawable="@drawable/baseline_alternate_email_24">
                                    <com.google.android.material.textfield.TextInputEditText
                                        android:id="@+id/tutored_email"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="textEmailAddress"
                                        android:text='@={viewModel.email}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/tutored_nuit_label">
                                    <com.google.android.material.textfield.TextInputEditText
                                        android:id="@+id/tutored_nuit"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="number"
                                        android:maxLength="9"
                                        android:text='@={viewModel.nuit}' />
                                </com.google.android.material.textfield.TextInputLayout>
                            </LinearLayout>
                        </LinearLayout>
                    </com.google.android.material.card.MaterialCardView>

                    <!-- ============ CARD: Informações Laborais ============ -->
                    <com.google.android.material.card.MaterialCardView
                        android:id="@+id/card_laboral"
                        style="@style/Mentor.M3.Card"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginBottom="@dimen/dimen_12dp">

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="vertical"
                            android:padding="@dimen/dimen_16dp">

                            <!-- Cabeçalho -->
                            <LinearLayout
                                android:id="@+id/laboral_data"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="horizontal"
                                android:gravity="center_vertical"
                                android:onClick='@{(v)->viewModel.changeInitialDataViewStatus(v)}'>

                                <com.google.android.material.textview.MaterialTextView
                                    android:layout_width="0dp"
                                    android:layout_height="wrap_content"
                                    android:layout_weight="1"
                                    android:textColor="@color/background_dark"
                                    android:text="@string/labor_information_label"
                                    android:textAppearance="?attr/textAppearanceTitleLarge" />

                                <ImageButton
                                    android:id="@+id/btn_laboral_data"
                                    android:layout_width="40dp"
                                    android:layout_height="40dp"
                                    android:background="?attr/selectableItemBackgroundBorderless"
                                    android:contentDescription="@string/expand"
                                    android:src="@drawable/baseline_expand_more_24" />
                            </LinearLayout>

                            <!-- Corpo -->
                            <LinearLayout
                                android:id="@+id/laboral_lyt"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="vertical"
                                android:paddingTop="@dimen/dimen_8dp">

                                <!-- Categoria Profissional -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Dropdown.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:hint="@string/professional_category"
                                    app:endIconMode="dropdown_menu">
                                    <com.google.android.material.textfield.MaterialAutoCompleteTextView
                                        android:id="@+id/act_professional_category"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="none"
                                        android:focusable="false"
                                        android:cursorVisible="false"
                                        android:longClickable="false"
                                        android:clickable="true"
                                        app:adapter='@{professionalCategoryAdapter}'
                                        bind:selectedOpt='@={viewModel.professionalCategory}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <!-- Vínculo laboral -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Dropdown.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/vinculo_laboral"
                                    app:endIconMode="dropdown_menu">
                                    <com.google.android.material.textfield.MaterialAutoCompleteTextView
                                        android:id="@+id/act_mentee_labor_info"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="none"
                                        android:focusable="false"
                                        android:cursorVisible="false"
                                        android:longClickable="false"
                                        android:clickable="true"
                                        app:adapter='@{menteeLaborfoAdapter}'
                                        bind:selectedOpt='@={viewModel.menteeLabor}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <!-- ONG (condicional) -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Dropdown.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/ngo_name_label"
                                    app:endIconMode="dropdown_menu"
                                    android:visibility='@{viewModel.ONGEmployee ? View.VISIBLE : View.GONE}'>
                                    <com.google.android.material.textfield.MaterialAutoCompleteTextView
                                        android:id="@+id/act_ngo"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="none"
                                        android:focusable="false"
                                        android:cursorVisible="false"
                                        android:longClickable="false"
                                        android:clickable="true"
                                        app:adapter='@{ngoAdapter}'
                                        bind:selectedOpt='@={viewModel.selectedNgo}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <!-- Ano de formação -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/training_year_label">
                                    <com.google.android.material.textfield.TextInputEditText
                                        android:id="@+id/training_year"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="number"
                                        android:maxLength="4"
                                        android:text='@={viewModel.trainingYear}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <com.google.android.material.textview.MaterialTextView
                                    android:layout_width="wrap_content"
                                    android:layout_height="wrap_content"
                                    android:text="@string/skip_zero_session_label"
                                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                                    android:layout_marginTop="@dimen/dimen_12dp"/>

                                <!-- Isenção da Sessão Zero -->
                                <RadioGroup
                                    android:id="@+id/rg_skip_zero_session"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:orientation="horizontal"
                                    android:layout_marginTop="@dimen/dimen_12dp"
                                    android:visibility="visible">

                                    <com.google.android.material.radiobutton.MaterialRadioButton
                                        android:id="@+id/rb_skip_yes"
                                        android:layout_width="0dp"
                                        android:layout_height="wrap_content"
                                        android:layout_weight="1"
                                        android:text="@string/yes"
                                        android:checked='@{viewModel.skipZeroSession == true}'
                                        android:onClick='@{() -> viewModel.setSkipZeroSession(true)}'
                                        android:textColor='@color/input_labels' />

                                    <com.google.android.material.radiobutton.MaterialRadioButton
                                        android:id="@+id/rb_skip_no"
                                        android:layout_width="0dp"
                                        android:layout_height="wrap_content"
                                        android:layout_weight="1"
                                        android:text="@string/no"
                                        android:checked='@{viewModel.skipZeroSession == false}'
                                        android:onClick='@{() -> viewModel.setSkipZeroSession(false)}'
                                        android:textColor='@color/input_labels' />
                                </RadioGroup>

                            </LinearLayout>
                        </LinearLayout>
                    </com.google.android.material.card.MaterialCardView>

                    <!-- ============ CARD: Unidade Sanitária ============ -->
                    <com.google.android.material.card.MaterialCardView
                        android:id="@+id/card_unidade"
                        style="@style/Mentor.M3.Card"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content">

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="vertical"
                            android:padding="@dimen/dimen_16dp">

                            <!-- Cabeçalho -->
                            <LinearLayout
                                android:id="@+id/healt_unit"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="horizontal"
                                android:gravity="center_vertical"
                                android:onClick='@{(v)->viewModel.changeInitialDataViewStatus(v)}'>

                                <com.google.android.material.textview.MaterialTextView
                                    android:layout_width="0dp"
                                    android:layout_height="wrap_content"
                                    android:layout_weight="1"
                                    android:textColor="@color/background_dark"
                                    android:text="@string/health_unit_label"
                                    android:textAppearance="?attr/textAppearanceTitleLarge" />

                                <ImageButton
                                    android:id="@+id/btn_healt_unit"
                                    android:layout_width="40dp"
                                    android:layout_height="40dp"
                                    android:background="?attr/selectableItemBackgroundBorderless"
                                    android:contentDescription="@string/expand"
                                    android:src="@drawable/baseline_expand_more_24" />
                            </LinearLayout>

                            <!-- Corpo -->
                            <LinearLayout
                                android:id="@+id/healt_unit_lyt"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="vertical"
                                android:paddingTop="@dimen/dimen_8dp">

                                <!-- Província -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Dropdown.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:hint="@string/province_label"
                                    app:endIconMode="dropdown_menu">
                                    <com.google.android.material.textfield.MaterialAutoCompleteTextView
                                        android:id="@+id/act_province"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="none"
                                        android:focusable="false"
                                        android:cursorVisible="false"
                                        android:longClickable="false"
                                        android:clickable="true"
                                        app:adapter='@{provinceAdapter}'
                                        bind:selectedOpt='@={viewModel.province}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <!-- Distrito -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Dropdown.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/district_label"
                                    app:endIconMode="dropdown_menu">
                                    <com.google.android.material.textfield.MaterialAutoCompleteTextView
                                        android:id="@+id/act_district"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="none"
                                        android:focusable="false"
                                        android:cursorVisible="false"
                                        android:longClickable="false"
                                        android:clickable="true"
                                        app:adapter='@{districtAdapter}'
                                        bind:selectedOpt='@={viewModel.district}' />
                                </com.google.android.material.textfield.TextInputLayout>

                                <!-- Unidade Sanitária -->
                                <com.google.android.material.textfield.TextInputLayout
                                    style="@style/Mentor.M3.TextInput.Dropdown.Outlined"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="@dimen/dimen_8dp"
                                    android:hint="@string/health_facility_label"
                                    app:endIconMode="dropdown_menu">
                                    <com.google.android.material.textfield.MaterialAutoCompleteTextView
                                        android:id="@+id/act_healthfacility"
                                        android:layout_width="match_parent"
                                        android:layout_height="wrap_content"
                                        android:inputType="none"
                                        android:focusable="false"
                                        android:cursorVisible="false"
                                        android:longClickable="false"
                                        android:clickable="true"
                                        app:adapter='@{healthfacilityAdapter}'
                                        bind:selectedOpt='@={viewModel.healthFacility}' />
                                </com.google.android.material.textfield.TextInputLayout>
                            </LinearLayout>
                        </LinearLayout>
                    </com.google.android.material.card.MaterialCardView>

                    <!-- Botão Salvar -->
                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/save_tutored"
                        style="@style/Mentor.M3.Button"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="@dimen/dimen_16dp"
                        android:text="@string/submit"
                        android:onClick='@{() -> viewModel.save()}' />
                </LinearLayout>
            </androidx.core.widget.NestedScrollView>

            <!-- CARD DE ESTADO -->
            <com.google.android.material.card.MaterialCardView
                android:id="@+id/save_state_card"
                style="@style/Mentor.M3.Card"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_gravity="top"
                android:layout_margin="@dimen/dimen_18dp"
                android:padding="@dimen/dimen_24dp"
                android:visibility='@{viewModel.savingCardVisible ? View.VISIBLE : View.GONE}'>

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:gravity="center"
                    android:orientation="vertical"
                    android:padding="@dimen/dimen_8dp">

                    <!-- CIRCULAR M3 - INDETERMINATE -->
                    <com.google.android.material.progressindicator.CircularProgressIndicator
                        android:id="@+id/progress"
                        style="@style/Widget.Material3.CircularProgressIndicator"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        app:indicatorSize="64dp"
                        android:indeterminate="true"
                        android:visibility='@{viewModel.savingRunning ? View.VISIBLE : View.GONE}' />

                    <!-- SUCESSO / ERRO (como já estava) -->
                    <ImageView
                        android:id="@+id/icon_success"
                        android:layout_width="64dp"
                        android:layout_height="64dp"
                        android:src="@drawable/baseline_check_circle_24"
                        android:visibility='@{viewModel.savingSuccess ? View.VISIBLE : View.GONE}'
                        app:tint="?attr/colorPrimary" />

                    <ImageView
                        android:id="@+id/icon_error"
                        android:layout_width="64dp"
                        android:layout_height="64dp"
                        android:src="@drawable/baseline_error_24"
                        android:visibility='@{viewModel.savingError ? View.VISIBLE : View.GONE}'
                        app:tint="?attr/colorError" />

                    <com.google.android.material.textview.MaterialTextView
                        android:id="@+id/save_msg"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="@dimen/dimen_12dp"
                        android:text='@{viewModel.savingMessage}'
                        android:textAppearance="?attr/textAppearanceTitleMedium"
                        android:gravity="center" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/save_action_btn"
                        style="@style/Mentor.M3.Button"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="@dimen/dimen_16dp"
                        android:text='@{viewModel.savingSuccess ? @string/continue_label : @string/try_again}'
                        android:visibility='@{viewModel.savingRunning ? View.GONE : View.VISIBLE}'
                        android:onClick='@{() -> viewModel.onSaveCardPrimaryAction()}' />
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>


        </FrameLayout>

    </androidx.coordinatorlayout.widget.CoordinatorLayout>
</layout>
